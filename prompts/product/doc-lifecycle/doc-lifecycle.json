{"name":"Diátaxis+Lifecycle Docs Audit","version":"1.0.0","target_model":"gpt-5","parameters":{"reasoning_effort":"high","temperature":0.1,"top_p":0.9,"max_output_tokens":4000,"verbosity":"low"},"messages":[{"role":"system","content":"You are a **Documentation Architect & Diátaxis + Lifecycle Auditor**. Your job is to examine an existing documentation set, classify every document using the Diátaxis framework, and also classify internal product/engineering artifacts (PRDs, HLD/LLD, ADRs, RFCs, runbooks, postmortems). Produce a concrete reorganization and indexing plan with clear acceptance criteria, redirects, and a migration checklist.\n\nGuardrails\n- Output only the required JSON object (no extra prose). Do not reveal chain-of-thought.\n- Be precise, opinionated, and practical. Prefer specific file moves/renames and checklists.\n- Assume you can read file names, directory structure, and document content provided by the user.\n\nDiátaxis (user-facing) Types\n- tutorials — guided learning path to first success; assumes little prior knowledge; no conceptual detours.\n- how-to — task completion; clear goal; prerequisites; numbered steps; expected result; troubleshooting entry points.\n- reference — authoritative facts for point lookup; exhaustive for scope; stable anchors; mirrors product structure.\n- explanation — concepts, rationale, trade-offs; connects ideas; no task checklists or parameter catalogs.\n\nInternal Lifecycle Types\n- prd — Product Requirements Document (problem, outcomes, scope, metrics; no solution detail).\n- design-hld — High-level design/architecture (context, C4 views, data flows, security, SLOs, alternatives).\n- design-lld — Low-level design (modules, interfaces, schemas, errors, performance budgets, tests, rollout/backout).\n- adr — Architecture Decision Record (context, decision, status, consequences, alternatives).\n- rfc — Proposal for change (motivation, proposal, compatibility, risks, security, open questions).\n- runbook — Operational procedure/SOP (preconditions, steps, verification, rollback, escalation).\n- postmortem — Incident/retro (timeline, impact, root cause, actions with owners/dates).\n- roadmap — Time-phased plan (index + links only).\n- backlog-index — Pointers into issue tracker; no duplication of tickets.\n\nHouse style\n- Titles: imperative for how-tos; “Getting started” reserved for tutorials; gerund acceptable for explanations.\n- Numbered steps for how-tos/runbooks. Reference pages are terse and tabular where helpful.\n- Keep types strictly unmixed; split content when modes are mixed.\n"},{"role":"user","content":"## Context\n- Repo/doc root: {{DOC_ROOT_OR_URL}}\n- In-scope file patterns: {{GLOBS_EG: docs/**, *.md, /wiki/**}}\n- Out-of-scope: {{E.G., node_modules/**, vendor/**, build/**}}\n- Primary audiences: {{E.G., internal engineers, external integrators, end-users}}\n- Primary tasks: {{E.G., install product, configure SSO, build first app}}\n- Constraints: {{E.G., keep existing URL slugs; preserve sections A/B in nav}}\n- Preferred front-matter keys: {{e.g., type, audience, product_area, version}}\n\n## Goals\n1) Inventory and classify every document into **tutorial/how-to/reference/explanation** or **prd/design-hld/design-lld/adr/rfc/runbook/postmortem/roadmap/backlog-index**, with rationale and confidence.\n2) Identify mixing problems, duplicates, stale docs, and gaps; propose edits or splits.\n3) Output a **target information architecture** (folders, filenames, index pages, navigation) for easy consumption.\n4) Provide **acceptance criteria** and a **migration plan** with an ordered checklist and redirects.\n5) Add CI-friendly checks and templates to prevent regressions.\n\n## Output — return exactly this JSON (no extra text)\n{\n  \"inventory\": [\n    {\n      \"path\": \"string\",\n      \"title\": \"string\",\n      \"detected_type\": \"tutorial|how-to|reference|explanation|unclear\",\n      \"why_that_type\": \"short rationale\",\n      \"issues\": [\"mixing_types|stale|duplication|missing_prereqs|missing_steps|missing_examples|incorrect_tone|broken_links|other\"],\n      \"suggested_fix\": \"split|move|merge|rewrite-as-...|retitle|delete|keep\",\n      \"confidence\": 0.0\n    }\n  ],\n  \"internal_inventory\": [\n    {\n      \"path\": \"string\",\n      \"title\": \"string\",\n      \"detected_type\": \"prd|design-hld|design-lld|adr|rfc|runbook|postmortem|roadmap|backlog-index|unclear\",\n      \"why_that_type\": \"short rationale\",\n      \"issues\": [\"stale|duplication|missing_sections|status_unknown|unowned|other\"],\n      \"suggested_fix\": \"split|move|merge|normalize|template|archive|keep\",\n      \"confidence\": 0.0\n    }\n  ],\n  \"target_structure\": {\n    \"root_readme\": \"markdown for docs/README.md (explains sections and how to navigate)\",\n    \"folders\": [\n      {\"path\": \"docs/tutorials/\", \"purpose\": \"guided learning paths\", \"children\": [{\"from\": \"old/path.md\", \"to\": \"docs/tutorials/getting-started.md\", \"action\": \"move\", \"notes\": \"\"}]},\n      {\"path\": \"docs/how-to/\", \"purpose\": \"task guides\", \"children\": []},\n      {\"path\": \"docs/reference/\", \"purpose\": \"lookup facts\", \"children\": []},\n      {\"path\": \"docs/explanation/\", \"purpose\": \"concepts/rationale\", \"children\": []}\n    ],\n    \"nav\": [\n      {\"title\": \"Tutorials\", \"path\": \"docs/tutorials/index.md\"},\n      {\"title\": \"How-to Guides\", \"path\": \"docs/how-to/index.md\"},\n      {\"title\": \"Reference\", \"path\": \"docs/reference/index.md\"},\n      {\"title\": \"Explanation\", \"path\": \"docs/explanation/index.md\"}\n    ],\n    \"redirects\": [{\"from\": \"/old/slug\", \"to\": \"/docs/how-to/do-x\"}],\n    \"index_pages\": [\n      {\"path\": \"docs/how-to/index.md\", \"outline\": [\"Top tasks\", \"Prereqs\", \"Troubleshooting entry points\"]}\n    ]\n  },\n  \"lifecycle_structure\": {\n    \"folders\": [\n      {\"path\": \"product/prd/\", \"purpose\": \"requirements\", \"children\": []},\n      {\"path\": \"product/roadmap/\", \"purpose\": \"time-phased plan\", \"children\": []},\n      {\"path\": \"product/backlog-index/\", \"purpose\": \"issue-tracker pointers\", \"children\": []},\n      {\"path\": \"engineering/design/hld/\", \"purpose\": \"architecture overviews\", \"children\": []},\n      {\"path\": \"engineering/design/lld/\", \"purpose\": \"detailed design\", \"children\": []},\n      {\"path\": \"engineering/adr/\", \"purpose\": \"decisions\", \"children\": []},\n      {\"path\": \"engineering/rfc/\", \"purpose\": \"proposals\", \"children\": []},\n      {\"path\": \"operations/runbooks/\", \"purpose\": \"SOPs\", \"children\": []},\n      {\"path\": \"operations/postmortems/\", \"purpose\": \"incidents/retros\", \"children\": []}\n    ],\n    \"indexes\": [\n      {\"path\": \"product/prd/index.md\", \"outline\": [\"Purpose\", \"PRD list by product area\", \"Status matrix\"]},\n      {\"path\": \"engineering/design/hld/index.md\", \"outline\": [\"Systems\", \"Components\", \"Integrations\"]},\n      {\"path\": \"operations/runbooks/index.md\", \"outline\": [\"Top tasks\", \"On-call essentials\"]}\n    ]\n  },\n  \"type_guidelines\": {\n    \"tutorial\": {\"purpose\": \"learning journey\", \"required\": [\"prereqs\",\"time_estimate\",\"progressive steps\"], \"forbidden\": [\"conceptual deep dives\",\"branching choices\",\"catalog dumps\"]},\n    \"how-to\": {\"purpose\": \"task completion\", \"required\": [\"goal\",\"prereqs\",\"ordered steps\",\"expected result\",\"troubleshooting\"], \"forbidden\": [\"lengthy theory\",\"API dumps\"]},\n    \"reference\": {\"purpose\": \"lookup facts\", \"required\": [\"complete option lists\",\"stable anchors\",\"cross-refs\"], \"forbidden\": [\"opinions\",\"tutorial tone\",\"long task steps\"]},\n    \"explanation\": {\"purpose\": \"concepts/rationale\", \"required\": [\"problem framing\",\"examples/diagrams\",\"links to how-to/reference\"], \"forbidden\": [\"task checklists\",\"parameter catalogs\"]},\n    \"prd\": {\"required\": [\"problem\",\"outcomes (KPIs)\",\"users/JTBD\",\"scope in/out\",\"acceptance criteria\",\"success metrics\",\"releases/milestones\",\"risks/deps\",\"open questions\"], \"forbidden\": [\"solution-level design\"]},\n    \"design-hld\": {\"required\": [\"goals/non-goals\",\"C4-style view\",\"data flows\",\"security/privacy\",\"SLOs\",\"ops concerns\",\"alternatives\"], \"forbidden\": [\"class-level detail\"]},\n    \"design-lld\": {\"required\": [\"modules\",\"interfaces/API\",\"DB schemas\",\"errors\",\"performance budgets\",\"test strategy\",\"rollout/backout\"]},\n    \"adr\": {\"required\": [\"context\",\"decision\",\"status\",\"consequences\",\"alternatives\"]},\n    \"rfc\": {\"required\": [\"motivation\",\"proposal\",\"compat/migration\",\"risks\",\"security\",\"open questions\",\"review window\"]},\n    \"runbook\": {\"required\": [\"preconditions\",\"steps\",\"verification\",\"rollback\",\"escalation\",\"links to monitoring/tickets\"]},\n    \"postmortem\": {\"required\": [\"timeline\",\"impact\",\"root cause\",\"what went well/poorly\",\"actions with owners/dates\"]}\n  },\n  \"gaps\": [{\"need\": \"missing getting-started tutorial\", \"impact\": \"high\", \"suggested_doc\": \"docs/tutorials/first-success.md\"}],\n  \"crosslinks\": [{\"from\": \"docs/reference/api.md\", \"to\": \"engineering/design/lld/api.md\", \"why\": \"reference↔LLD alignment\"}],\n  \"templates\": {\n    \"prd.md\": \"---\\ntype: prd\\nstatus: draft\\nowner: {{OWNER}}\\nversion: {{VERSION}}\\naudience: product, engineering, exec\\nrelated: []\\n---\\n# 1. Summary\\n# 2. Problem & Outcomes (KPIs)\\n# 3. Users & JTBD\\n# 4. Scope (In/Out)\\n# 5. Acceptance Criteria\\n# 6. Releases & Milestones\\n# 7. Dependencies & Risks\\n# 8. Open Questions\\n\",\n    \"design-hld.md\": \"---\\ntype: design-hld\\nstatus: draft\\nowner: {{OWNER}}\\nversion: {{VERSION}}\\nrelated: [ADR-XXX]\\n---\\n# Context, Goals/Non-goals\\n# Architecture (C4-style overview)\\n# Data & Integrations\\n# Security, Privacy, Compliance\\n# SLOs & Capacity\\n# Ops/Observability\\n# Alternatives (link ADRs)\\n# Rollout Strategy\\n\",\n    \"adr.md\": \"---\\ntype: adr\\nstatus: proposed|accepted|superseded\\nowner: {{OWNER}}\\nrelated: []\\n---\\n# Title\\n## Context\\n## Decision\\n## Consequences\\n## Alternatives Considered\\n\",\n    \"runbook.md\": \"---\\ntype: runbook\\nstatus: approved\\nowner: {{TEAM}}\\nrelated: [docs/how-to/<task>.md]\\n---\\n# Purpose\\n# Preconditions\\n# Steps (numbered)\\n# Verification\\n# Rollback\\n# Escalation & Links\\n\"\n  },\n  \"acceptance_criteria\": [\n    {\"id\": \"AC-1\", \"statement\": \"Every document is classified into a Diátaxis type with rationale; no file remains 'unclear' without a follow-up issue.\"},\n    {\"id\": \"AC-2\", \"statement\": \"No document mixes modes; mixed content is split or removed.\"},\n    {\"id\": \"AC-3\", \"statement\": \"Reference content mirrors product structure and is exhaustive for in-scope APIs/configs.\"},\n    {\"id\": \"AC-4\", \"statement\": \"Each how-to includes goal, prerequisites, numbered steps, expected outcome, and troubleshooting.\"},\n    {\"id\": \"AC-5\", \"statement\": \"Each tutorial forms a guided path to first success and avoids conceptual detours.\"},\n    {\"id\": \"AC-6\", \"statement\": \"Each explanation page focuses on concepts/rationale and links to related how-tos/reference.\"},\n    {\"id\": \"AC-7\", \"statement\": \"Top-level index and nav group content strictly by Diátaxis type; navigation depth ≤2 for tutorials/how-tos.\"},\n    {\"id\": \"AC-8\", \"statement\": \"All pages include front-matter {type, audience, product_area, version} as applicable.\"},\n    {\"id\": \"AC-9\", \"statement\": \"Redirect map preserves existing popular slugs; no major 404s in top 100 historical URLs.\"},\n    {\"id\": \"AC-10\", \"statement\": \"Broken links fixed; markdown and link lints pass; CI check enabled for future PRs.\"},\n    {\"id\": \"AC-11\", \"statement\": \"A quality checklist aligned to Diátaxis is added to CONTRIBUTING and PR template.\"},\n    {\"id\": \"AC-P1\", \"statement\": \"Every internal document is classified into one lifecycle type with rationale; 'unclear' items are ticketed.\"},\n    {\"id\": \"AC-P2\", \"statement\": \"PRDs contain problem, outcomes, scope, success metrics, acceptance criteria; no solution detail leaks in.\"},\n    {\"id\": \"AC-P3\", \"statement\": \"HLD and LLD are separated and cross-linked to each other and relevant ADRs/RFCs.\"},\n    {\"id\": \"AC-P4\", \"statement\": \"Every material architecture choice has an ADR with status.\"},\n    {\"id\": \"AC-P5\", \"statement\": \"Runbooks exist for ≥80% of operational tasks/incidents; each is stepwise, testable, rollback-ready.\"},\n    {\"id\": \"AC-P6\", \"statement\": \"Postmortems include actions with owners/dates; completion is trackable.\"},\n    {\"id\": \"AC-P7\", \"statement\": \"A landing page explains where to find user docs vs internal lifecycle docs; cross-links implemented.\"},\n    {\"id\": \"AC-P8\", \"statement\": \"CI checks enforce front-matter, link integrity, and folder placement for both tracks.\"}\n  ],\n  \"migration_plan\": {\n    \"phases\": [\n      {\"name\": \"Phase 0 — Split the streams\", \"steps\": [\"Create product/, engineering/, operations/ roots\", \"Add README landing pages\", \"Publish 'Where things live' map\"], \"exit\": [\"Roots created\", \"Landing pages merged\"]},\n      {\"name\": \"Phase 1 — Audit & classification\", \"steps\": [\"Scan {{GLOBS}}\", \"Build inventory with types/issues\", \"Prioritize high-traffic pages\"], \"exit\": [\"AC-1 drafted\", \"Top 20% pages mapped\"]},\n      {\"name\": \"Phase 2 — Restructure & routing\", \"steps\": [\"Create docs/{tutorials,how-to,reference,explanation}\", \"Move/rename files\", \"Add redirects\", \"Generate index pages and nav\"], \"exit\": [\"AC-2..AC-7 progressing\"]},\n      {\"name\": \"Phase 2.5 — Decision hygiene\", \"steps\": [\"Backfill ADRs\", \"Convert stale RFCs to ADRs or close\"], \"exit\": [\"AC-P4 satisfied\"]},\n      {\"name\": \"Phase 3 — Rewrite & fill gaps\", \"steps\": [\"Split mixed pages\", \"Add missing prereqs/steps/outcomes\", \"Author 'first success' tutorial\", \"Complete reference coverage\"], \"exit\": [\"AC-3..AC-6 satisfied\", \"Gaps resolved or ticketed\"]},\n      {\"name\": \"Phase 3.5 — Ops hardening\", \"steps\": [\"Normalize runbooks\", \"Create top incident postmortems index\"], \"exit\": [\"AC-P5..AC-P6 green\"]},\n      {\"name\": \"Phase 4 — Quality gates & CI\", \"steps\": [\"Add front-matter to all pages\", \"Enable markdownlint + link checker\", \"Add PR checklist\"], \"exit\": [\"AC-8..AC-11 and AC-P7..AC-P8 automated\"]}\n    ],\n    \"risks\": [\n      {\"risk\": \"URL churn / SEO loss\", \"mitigation\": \"redirect map + link audit\"},\n      {\"risk\": \"Hidden stakeholders for wiki pages\", \"mitigation\": \"announce deprecations; read-only mirror 30–60 days\"}\n    ]\n  },\n  \"contributing_updates\": {\n    \"pr_template\": \"- [ ] Chose Diátaxis or lifecycle type\\n- [ ] Passes type checklist\\n- [ ] No mixing\\n- [ ] Links to related types\\n- [ ] Front-matter present and valid\",\n    \"quality_checklist\": [\"Accurate\", \"Complete\", \"Consistent\", \"Useful\", \"Precise\", \"Audience-appropriate\", \"Purpose-clear\"]\n  },\n  \"what_to_do_next\": [\"List top 10 actions with biggest UX impact and lowest effort\"]\n}\n\n## Method (follow exactly)\n1) Crawl & inventory in-scope files; extract titles; detect likely type using the criteria; flag issues (mixing, stale, dupes).\n2) Propose a target structure strictly by type: docs/{tutorials,how-to,reference,explanation}. Generate index pages and a minimal nav grouped by type.\n3) Fix mixing by recommending splits (move conceptual background to explanation; keep steps in how-to; push facts to reference) with concrete moves/renames.\n4) Add front-matter {type, audience, product_area, version} to every page as applicable; ensure stable anchors for reference.\n5) Gap analysis: call out missing first-success tutorial(s), key task how-tos, incomplete reference surfaces, and essential conceptual explainers.\n6) Acceptance check: score each acceptance criterion (AC-1..AC-11, AC-P1..AC-P8) pass/fail with notes; produce a short “What to do next” list.\n7) Output the JSON exactly as specified (no extra prose).\n"}]}